<!DOCTYPE html>
<html>

<head>
    <title>Verify 41-Day Fix</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .test-case {
            margin: 15px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .before {
            background: #ffebee;
            border-color: #f44336;
        }

        .after {
            background: #e8f5e9;
            border-color: #4caf50;
        }

        .calculation {
            font-family: monospace;
            background: #f5f5f5;
            padding: 10px;
            margin: 10px 0;
        }
    </style>
</head>

<body>
    <h1>Fix Verification: 41-Day Issue</h1>

    <div class="test-case before">
        <h3>Before Fix (What you were seeing)</h3>
        <p><strong>Logic:</strong> Show full duration of reservations that start within timeframe</p>
        <div class="calculation">
            Reservation: 9/5/2025 to 10/15/2025
            Timeframe: Last 30 days (9/1/2025 to 10/1/2025)
            Result: 41 days (full duration)
        </div>
        <p><strong>Problem:</strong> Shows more days than the selected timeframe allows</p>
    </div>

    <div class="test-case after">
        <h3>After Fix (What you should see now)</h3>
        <p><strong>Logic:</strong> Only count days within the selected timeframe</p>
        <div class="calculation">
            Reservation: 9/5/2025 to 10/15/2025
            Timeframe: Last 30 days (9/1/2025 to 10/1/2025)
            Clipped to: 9/5/2025 to 10/1/2025
            Result: 27 days (clipped to timeframe)
        </div>
        <p><strong>Solution:</strong> Never exceeds the selected timeframe limit</p>
    </div>

    <div style="margin-top: 30px; padding: 20px; background: #e3f2fd; border: 1px solid #2196f3; border-radius: 8px;">
        <h3>Expected Results Now</h3>
        <p>All these devices should now show <strong>27 days</strong> instead of 41:</p>
        <ul>
            <li>US-FGT-101F-A: <strong>27 days</strong> (was 41)</li>
            <li>US-FGT-3001F-A: <strong>27 days</strong> (was 41)</li>
            <li>US-FGT-3701F: <strong>27 days</strong> (was 41)</li>
            <li>US-FAZ-300G: <strong>27 days</strong> (was 41)</li>
            <li>US-FGT-4201F-B: <strong>27 days</strong> (was 41)</li>
            <li>US-FGT-4201F-A: <strong>27 days</strong> (was 41)</li>
        </ul>

        <p><strong>Maximum days possible:</strong> 30 days (for "Last 30 days" selection)</p>
        <p><strong>Logic:</strong> Consistent with timeframe selection</p>
        <p><strong>User-friendly:</strong> No confusing numbers above the timeframe limit</p>
    </div>

    <script>
        // Verify the calculation
        const reservationStart = new Date('9/5/2025');
        const reservationEnd = new Date('10/15/2025');
        const timeframeStart = new Date('9/1/2025');
        const timeframeEnd = new Date('10/1/2025');

        // Original calculation (before fix)
        const originalDays = Math.ceil((reservationEnd - reservationStart) / (1000 * 60 * 60 * 24)) + 1;

        // Fixed calculation (after fix)
        const clippedStart = new Date(Math.max(reservationStart.getTime(), timeframeStart.getTime()));
        const clippedEnd = new Date(Math.min(reservationEnd.getTime(), timeframeEnd.getTime()));
        const fixedDays = Math.ceil((clippedEnd - clippedStart) / (1000 * 60 * 60 * 24)) + 1;

        console.log('Verification:');
        console.log('Original days:', originalDays);
        console.log('Fixed days:', fixedDays);
        console.log('Clipped range:', clippedStart.toDateString(), 'to', clippedEnd.toDateString());

        // Update the page with calculated values
        document.addEventListener('DOMContentLoaded', function () {
            const calculations = document.querySelectorAll('.calculation');
            if (calculations[1]) {
                calculations[1].innerHTML = `
Reservation: 9/5/2025 to 10/15/2025
Timeframe: Last 30 days (9/1/2025 to 10/1/2025)
Clipped to: ${clippedStart.toDateString()} to ${clippedEnd.toDateString()}
Result: ${fixedDays} days (clipped to timeframe)
                `;
            }
        });
    </script>
</body>

</html>